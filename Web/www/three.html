<html>
    <head>
        <title> Three.js example </title>

        <style>
            body { margin: 0}
            canvas { width: 100%; height: 100%;};
        </style>
    </head>

    <body>
        <script src="three.js"></script>
        <script>

            var data = "";

            // Initialise websockets
            function init()
            {
                testWebSocket();
            }

            function testWebSocket()
            {
                var wsUri           = "ws://" + window.location.hostname;
                websocket           = new WebSocket(wsUri);
                websocket.onopen    = function(evt) { onOpen    (evt) };
                websocket.onmessage = function(evt) { onMessage (evt) };
            }

            function onOpen(evt)
            {
                websocket.send("Please update: " + data);
            }

            function onMessage(evt)
            {
                data = evt.data;
            }

            window.addEventListener("load", init, false);

            // Three.js
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight);

            var renderer = new THREE.WebGLRenderer({antialis: true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            var geometry = new THREE.BoxGeometry(1, 1, 1);
            var material = new THREE.MeshBasicMaterial({color: 0xff0000});
            var cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            var rotation = new THREE.Matrix4().set(
                0.707, -0.707, 0, 0,
                0.707, 0.707,  0, 0,
                0,     0,      1, 0,
                0,     0,      0, 1
            );
            cube.applyMatrix(rotation);
            cube.position.z = -5;

            //Create an render loop to allow animation
            var render = function () {
                requestAnimationFrame( render );

                websocket.send("Please update: " + data);

                cube.rotation.x += 0.1;
                cube.rotation.y += 0.1;

                renderer.render(scene, camera);
            };

            render();
        </script>
    </body>